# Storage

The storage is the main place that stores all nodes and manages them. In the storage source items are converted into nodes according to their hierarchical structure and order.
The storage and any node in it have a lot of functions to control node behaviour and structure (see [storage functions](#Storage functions) and [node functions](#Node functions)).

## Storage props
| Prop                   |  Type   | Description  |
|------------------------|:-------:| -------------|
| **tree**                 | Component     | the TreeVue component |
| **treeOptions**                 | Object     | the TreeVue component options. See [Component options](../api/options.html)|
| **options**                 | Object     | internal storage options. |
| **CheckModes**                 | Object     | internal check modes enum.|
| **selectedNode**                 | Node     | Currently selected node |
| **originalItems**                 | Array of Object     | Array of the source items. |
| **nodes**                 | Array of Nodes     | Array of nodes. |
| **internalLastNodeId**                 | Number     | Internal integer counter for generating unique node identifiers. |

## Node structure
Any node has the following structure:

| Prop                   |  Type   | Description  |
|------------------------|:-------:| -------------|
| **id**                 | Number &#124; String &#124; Object     | unique identifier from source item or generated by the storage |
| **item**               | Object  | link to source item |
| **parent**             | Node    | link to a parent node. For root nodes it equals to **null** |
| **prev**               | Node    | link to a previous node on the same level of the node hierarchy. For first nodes on the level it equals to **null** |
| **next**               | Node    | link to a next node on the same level of the node hierarchy. For last nodes on the level it equals to **null** |
| **states**             | Object  | All main states of a node that can be changed programmatically. Some states can be set from the same source items' props. |
| **states.checked**     | Boolean | Indicates either a node is checked or not. Default value is **false**. Can be set from source item. |
| **states.disabled**    | Boolean | Indicates either a node is disabled or not. Default value is **false**. Can be set from source item. |
| **states.open**        | Boolean | Indicates either a node is expanded or collapsed. Default value is **false**. Can be set from source item. |
| **states.visible**     | Boolean | Indicates either a node is visible or not. Default value is **true**. Cannot be set from source item. This state is usually changed after applying a filter or clearing a filter. |
| **states.matched**     | Boolean | Indicates either a node is matched a filter. Default value is **false**. Cannot be set from source item. This state is intended for an internal use of filtering. |
| **styleClasses**       | Object  | Contains classes for different visual node parts. [See below](#Node-Style-Classes) |
| **styleClasses.default** | String &#124; Object | null | (**Not implemented yet**) Contains class(es) that is added to node checkbox classes. [See below](#Node-Style-Classes) |
| **styleClasses.checkbox** | String &#124; Object | null | Contains class(es) that is added to node checkbox classes. [See below](#Node-Style-Classes) |
| **styleClasses.expander** | String &#124; Object | null | Contains class(es) that is added to node expander classes. [See below](#Node-Style-Classes) |
| **styleClasses.icon** | String &#124; Object | null | Contains class(es) that is added to node icon classes. [See below](#Node-Style-Classes) |
| **styleClasses.text** | String &#124; Object | null | Contains class(es) that is added to node text classes. [See below](#Node-Style-Classes) |
| **icon**               | String  | classes that are added to <i> tag that represents a node icon. |
| **children**               | Array of Nodes  | child nodes created from child source items. |

## Node style classes
Every node can override classes from `options.styleClasses` by setting its own classes for all the node parts and also can have default style classes that applies to all its parts:

- `default`: classes that are added to classes of all the node subcomponents, default value is **null** (**Not implemented yet**)
- `checkbox`: classes that are added to classes of the node checkbox component, default value is **null**
- `expander`: classes that are added to classes of the node expander component, default value is **null**
- `icon`: classes that are added to classes of the node icon component, default value is **null**
- `text`: classes that are added to classes of the node text component, default value is **null**

Please note that `default` classes do not override other specific classes unlike classes from `options.styleClasses`.

To set node classes you can call the corresponding node's functions. See [node functions](#Node-functions)

## Storage functions
The storage functions allows to change a state or a structure of any specified node or a group of nodes.

| Function                   | Parameters   |  Return value | Description |
|------------------------|:------------:|:-------------|:-------------|
| **addChild(parent, item)**           | Node, item | Node  | Converts a source **item** to a node and adds the node to a **parent** node. Returns the added child node |
| **check(node, withChildren = false)**           | Node, Boolean   | none | Checks a node. If the **withChildren** parameter is **true** then all node's child nodes are checked recursively as well. |
| **checkAll()**           | none   | none | Checks all nodes. |
| **checkChildren(node)**           | Node   | none | Checks all node's child nodes recursively. |
| **checkVisible()**           | none   | none | Checks all visible nodes. |
| **clearFilter()**           | none    | none | Restores a visibility and an open state of all previously filtered nodes. See [filtering](#Filtering)|
| **collapse(node, withChildren = false)**           | Node, Boolean   | none | Collapses a node hiding its child nodes. If the **withChildren** parameter is **true** then all node's child nodes are collapsed recursively as well. |
| **collapseAll()**           | none   | none | Collapses all nodes hiding their child nodes. |
| **collapseChildren(node)**           | Node   | none | Collapses all node's child nodes recursively. |
| **disable(node, withChildren = false)**           | Node   | none | Disables a node. If the **withChildren** parameter is **true** then all node's child nodes are disabled recursively as well. |
| **disableAll()**           | none   | none | Disables all nodes. |
| **disableChildren(node)**           | Node   | none | Disables all node's child nodes recursively. |
| **enable(node, withChildren = false)**           | Node   | none | Enables a node. If the **withChildren** parameter is **true** then all node's child nodes are enabled recursively as well. |
| **enableAll()**           | none   | none | Enables all nodes. |
| **enableChildren(node)**           | Node   | none | Enables all node's child nodes recursively. |
| **expand(node, withChildren = false)**           | Node, Boolean   | none | Expands a node showing its child nodes. If the **withChildren** parameter is **true** then all node's child nodes are expanded recursively as well. |
| **expandAll()**           | none   | none | Expands all nodes showing their child nodes. |
| **expandChildren(node)**           | Node   | none | Expands all node's child nodes recursively. |
| **filter(searchObject, options)**           | String &#124; RegExp &#124; Function, Object    | Array of Nodes | Filters all nodes by the passed search criteria. Only matched nodes remain visible. Returns all matched nodes as a flat array. If `options.showChildren` parameter is **true** then all child nodes of any matched node will also be visible as well. See [filtering](#Filtering)|
| **findAll(selector)**           | Function   | Array of Nodes | Returns all nodes that are matched by a selector function or an **empty array** if no matched nodes are found. The selector function has one parameter **item**  equals to a source item of a node and must return true if a node is matched by the selector criteria. |
| **findOne(selector)**           | Function   | Node | Returns a node that is matched by a selector function or **null** if no matched node is found. The selector function has one parameter **item** equals to a source item of a node and must return true if a node is matched by the selector criteria. |
| **findParent(node, selector)**           | Node, Function   | Node | Returns a parent node that is matched by a selector function or **null** if no matched node is found. The selector function has one parameter **item** equals to a source item of a node and must return true if a parent node is matched by the selector criteria. The search is started from the nearest parent. |
| **findParents(node, selector)**           | Node, Function   | Node | Returns all parent nodes that are matched by a selector function or an **empty array** if no matched parent nodes are found. The selector function has one parameter **item** equals to a source item of a node and must return true if a parent node is matched by the selector criteria. The search is started from the nearest parent. |
| **getById(id)**           | Number &#124; String &#124; Object   | Node | Returns a node by its unique identifier or **null** if a node with the passed inentifier does not exist. |
| **getChecked()**           | none   | Array of Nodes | Returns all checked nodes as a flat array. |
| **getChildren(item)**           | Node   | array of source items | Returns children of the specified item (not a node!) according to `options.childrenProp` |
| **getEditName(node)**           | Node   | String | Returns a node prop that will be changed while editing. The returning value is depending on `options.editNameProp`. See [Component options](../api/options.html#Edit-node-caption) |
| **getName(node)**           | Node   | String | Returns a node caption. The returning value is depending on `options.nameProp`. See [Component options](../api/options.html) |
| **getVisibility(node)**           | Node   | Boolean | Returns a node visibility according to its parent **open** state and/or applied **filter**. |
| **getVisible()**           | none   | Array of Nodes | Returns all visible nodes as a flat array. |
| **insertChild(parent, item, beforeNode)**           | Node, item, Node | Node  | Converts a source **item** to a node and inserts the node to a **parent** node as the first child node. If the **beforeNode** parameter is **Node** then the new node will be inserted before the specified node. Returns the inserted child node. |
| **remove(node)**           | Node | none  | Converts a source **item** to a node and inserts the node to a **parent** node as the first child node. If the **beforeNode** parameter is **Node** then the new node will be inserted before the specified node. |
| **setCheckboxStyle(node, classList, withChildren = false)**           | Node, String &#124; Object, Boolean   | none | Sets **checkbox** style classes for a specified node. If the **withChildren** parameter is **true** then all node's child nodes **checkbox** style classes will be set recursively as well. |
| **setCheckState(node, state, withChildren = false)**           | Node, Boolean, Boolean   | none | Sets **checked** state of a node. If the **withChildren** parameter is **true** then all node's child nodes **checked** state are set recursively as well. |
| **setExpanderStyle(node, classList, withChildren = false)**           | Node, String &#124; Object, Boolean   | none | Sets **expander** style classes for a specified node. If the **withChildren** parameter is **true** then all node's child nodes **expander** style classes will be set recursively as well. |
| **setIconStyle(node, classList, withChildren = false)**           | Node, String &#124; Object, Boolean   | none | Sets **icon** style classes for a specified node. If the **withChildren** parameter is **true** then all node's child nodes **icon** style classes will be set recursively as well. |
| **setName(node, newName)**           | Node, String   | none | Set a node caption according to `options.editNameProp`. See [Component options](../api/options.html#Edit-node-caption) |
| **setNodes(items)**           | Array of Object   | none | Converts and sets items as the new source of nodes |
| **setOpenState(node, state, withChildren = false)**           | Node, Boolean, Boolean   | none | Sets **open** state of a node. If the **withChildren** parameter is **true** then all node's child nodes **open** state are set recursively as well. |
| **setSelected(node)**           | Node   | none | Selects a node. |
| **setTextStyle(node, classList, withChildren = false)**           | Node, String &#124; Object, Boolean   | none | Sets **text** style classes for a specified node. If the **withChildren** parameter is **true** then all node's child nodes **text** style classes will be set recursively as well. |
| **showNode(node)**           | Node   | none | Expands all node's parent nodes to make it possiable to show the specified node. |
| **sort(comparator)**           | Function   | none | Sorts all nodes recursively using a specified comparator function. See [sort](#Sort)|
| **uncheck(node, withChildren = false)**           | Node, Boolean   | none | Unchecks a node. If the **withChildren** parameter is **true** then all node's child nodes are unchecked recursively as well. |
| **uncheckAll()**           | none   | none | Unchecks all nodes. |
| **uncheckChildren(node)**           | Node   | none | Unchecks all node's child nodes recursively. |
| **uncheckVisible()**           | none   | none | Unchecks all visible nodes. |
| **visitAll(nodes, nodeCallback, onlyVisible = false)**           | Array of nodes, Function, Boolean   | none | Calls a function passed as the parameter on every node in the passed node array recursively and passes to it the corresponding node. If the third parameter **onlyVisible** is set to **true** than the function will be called for the visible nodes only. |
| **visitAllParents(node, nodeCallback)**           | Node, Function   | none | Calls a function passed as the parameter on every node's parent node of the passed node and passes to it the corresponding parent node. |

## Node functions
Node functions allows to change a state or a structure of a node.

| Function                 | Parameters | Return value | Description |
|--------------------------|:----------:|:-------------|:-------------|
| **addChild(child)**           | item       | Node  | Converts a source **item** to a node and adds it as the last child node. Returns the added child node |
| **check(withChildren)**           | Boolean   | none | Checks the node. If the **withChildren** parameter is **true** then all child nodes are checked recursively as well. |
| **checkChildren()**           | none   | none | Checks all child nodes recursively. |
| **collapse(withChildren)**             | Boolean    | none | Collapses the node hiding its child nodes. If the **withChildren** parameter is **true** then all child nodes are collapsed recursively as well. |
| **collapseChildren()**     | none       | none | Collapses all child nodes recursively. |
| **deselect()**           | none   | none | Deselects the node. |
| **disable(withChildren)**           | Boolean   | none | Disables the node. If the **withChildren** parameter is **true** then all child nodes are disabled recursively as well. |
| **disableChildren()**   | none   | none | Disables all child nodes recursively. |
| **enable(withChildren)**           | Boolean   | none | Enables the node. If the **withChildren** parameter is **true** then all child nodes are enabled recursively as well. |
| **enableChildren()**           | none   | none | Enables all child nodes recursively. |
| **expand(withChildren)**             | Boolean    | none | Expands the node showing its child nodes. If the **withChildren** parameter is **true** then all child nodes are expanded recursively as well. |
| **expandChildren()**     | none       | none | Expands all the node's child nodes recursively. |
| **findParent(selector)**           | Function   | Node | Returns a parent node that is matched by a selector function or **null** if no matched node is found. The selector function has one parameter **item** equals to a source item of a node and must return true if a parent node is matched by the selector criteria. The search is started from the nearest parent. |
| **findParents(selector)**           | Function   | Node | Returns all parent nodes that are matched by a selector function or an **empty array** if no matched parent nodes are found. The selector function has one parameter **item** equals to a source item of a node and must return true if a parent node is matched by the selector criteria. The search is started from the nearest parent. |
| **getName()**           | none   | String | Returns the caption. The returning value is depending on `options.nameProp`. See [Component options](../api/options.html) |
| **indeterminate()**           | none   | none | Returns **true** if there are some checked and some unchecked child nodes simultaniously and `options.checkMode` = **linked**. |
| **insertChild(item, beforeNode)**        | item, Node | Node  | Converts a source **item** to a node and inserts it as the first child node. If the **beforeNode** parameter is **Node** then the new node will be inserted before the specified node. Returns the inserted child node. |
| **resetCheckboxStyle(withChildren)**           | Boolean   | none | Resets **checkbox** style classes. If the **withChildren** parameter is **true** then all child nodes **checkbox** style classes will be reset recursively as well. |
| **resetExpanderStyle(withChildren)**           | Boolean   | none | Resets **expander** style classes. If the **withChildren** parameter is **true** then all child nodes **expander** style classes will be reset recursively as well. |
| **resetIconStyle(withChildren)**           | Boolean   | none | Resets **icon** style classes. If the **withChildren** parameter is **true** then all child nodes **icon** style classes will be reset recursively as well. |
| **resetTextStyle(withChildren)**           | Boolean   | none | Resets **text** style classes. If the **withChildren** parameter is **true** then all child nodes **text** style classes will be reset recursively as well. |
| **select()**           | none   | none | Selects the node. |
| **setCheckboxStyle(classList, withChildren = false)**           | String &#124; Object, Boolean   | none | Sets **checkbox** style classes. If the **withChildren** parameter is **true** then all child nodes **checkbox** style classes will be set recursively as well. |
| **setExpanderStyle(classList, withChildren = false)**           | String &#124; Object, Boolean   | none | Sets **expander** style classes. If the **withChildren** parameter is **true** then all child nodes **expander** style classes will be set recursively as well. |
| **setIconStyle(classList, withChildren = false)**           | String &#124; Object, Boolean   | none | Sets **icon** style classes. If the **withChildren** parameter is **true** then all child nodes **icon** style classes will be set recursively as well. |
| **setTextStyle(classList, withChildren = false)**           | String &#124; Object, Boolean   | none | Sets **text** style classes. If the **withChildren** parameter is **true** then all child nodes **text** style classes will be set recursively as well. |
| **show()**           | none   | none | Expands all parent nodes to make it possiable to show the node. |
| **uncheck(withChildren)**           | Boolean   | none | Unchecks the node. If the **withChildren** parameter is **true** then all child nodes are unchecked recursively as well. |
| **uncheckChildren()**           | none   | none | Unchecks all child nodes recursively. |
| **visible()**           | none   | none | Returns the node visibility according to its parent **open** state and/or applied **filter**. |
